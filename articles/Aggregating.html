<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EROITools">
<title>Aggregating EROIs by fossil fuel group • EROITools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregating EROIs by fossil fuel group">
<meta property="og:description" content="EROITools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EROITools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/EROITools.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Aggregating.html">Aggregating EROIs by fossil fuel group</a>
    <a class="dropdown-item" href="../articles/Breakdown.html">Breaking down useful stage EROIs by sector or end-use</a>
    <a class="dropdown-item" href="../articles/Indirect_Energy.html">Adding indirect or other energy requirements</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Aggregating EROIs by fossil fuel group</h1>
            
      
      
      <div class="d-none name"><code>Aggregating.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="domestic-perspective">Domestic perspective<a class="anchor" aria-label="anchor" href="#domestic-perspective"></a>
</h2>
<div class="section level3">
<h3 id="primary-and-final-stage-aggregations">Primary and final stage aggregations<a class="anchor" aria-label="anchor" href="#primary-and-final-stage-aggregations"></a>
</h3>
<p>Primary stage EROIs can be simply aggregated with the
<code>aggregate_primary_stage_erois</code>. The function calculates, for
each fossil fuel group (all fossil fuels, coal products, natural gas,
oil and gas products, and oil products), the shares of each product in
the primary extraction phase (which is why the <code>tidy_AB_dta</code>
is passed as argument). Then, EROIs are computed by calculating the
weighted average of EROIs. So, for country A, the share of coal in the
group “Coal products” will be one, and the aggregated EROI for “Coal
products” will be equal to the one of coal.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating primary stage EROIs:</span></span>
<span><span class="va">aggregated_primary_stage_erois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_primary_stage_erois.html">aggregate_primary_stage_erois</a></span><span class="op">(</span></span>
<span>    .tidy_erois_df <span class="op">=</span> <span class="va">tidy_AB_erois_dta</span>,</span>
<span>    .tidy_iea_df <span class="op">=</span> <span class="va">tidy_AB_dta</span>,</span>
<span>    eroi_calc_method <span class="op">=</span> <span class="st">"dta"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 12</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; Groups: Country, Method, Energy.type, Last.stage, Year, Eroi.method, Type, Boundary, Product.Group [12]</span></span>
<span><span class="co">#&gt; $ Country       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "…</span></span>
<span><span class="co">#&gt; $ Method        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", …</span></span>
<span><span class="co">#&gt; $ Energy.type   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "…</span></span>
<span><span class="co">#&gt; $ Last.stage    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 20…</span></span>
<span><span class="co">#&gt; $ Eroi.method   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", …</span></span>
<span><span class="co">#&gt; $ Type          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Gross", "Gross", "N…</span></span>
<span><span class="co">#&gt; $ Boundary      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "All", "Feedstock", "Feedstock", "Feedstoc…</span></span>
<span><span class="co">#&gt; $ Product.Group <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All fossil fuels", "Coal products", "Oil and gas produc…</span></span>
<span><span class="co">#&gt; $ Energy.stage  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Primary", "Primary", "Primary", "Primary", "Primary", "…</span></span>
<span><span class="co">#&gt; $ Group.eroi    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 40.52669, 91.08310, 33.21149, 42.90249, 100.00000, 34.97…</span></span></code></pre></div>
<p>Likewise, aggregated final stage EROIs are calculated with the
<code>aggregate_final_stage_erois</code>. This function calculates, for
each fossil fuel group, the shares of each product in the final use of a
given country. It does so for the different final energy carriers:
electricity, heat, fuel, and all carriers together. Then, aggregated
final stage EROIs are calculated according to those shares.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating final stage EROIs:</span></span>
<span><span class="va">aggregated_final_stage_erois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_final_stage_erois.html">aggregate_final_stage_erois</a></span><span class="op">(</span></span>
<span>    .tidy_erois_df <span class="op">=</span> <span class="va">tidy_AB_erois_dta</span>,</span>
<span>    .tidy_iea_df <span class="op">=</span> <span class="va">tidy_AB_dta</span>,</span>
<span>    eroi_calc_method <span class="op">=</span> <span class="st">"dta"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 80</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; Groups: Country, Method, Energy.type, Last.stage, Year, Eroi.method, Type, Boundary, Non_Energy_Uses, Product.Group [40]</span></span>
<span><span class="co">#&gt; $ Country         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A",…</span></span>
<span><span class="co">#&gt; $ Method          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E",…</span></span>
<span><span class="co">#&gt; $ Last.stage      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "Final", …</span></span>
<span><span class="co">#&gt; $ Year            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, …</span></span>
<span><span class="co">#&gt; $ Eroi.method     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA"…</span></span>
<span><span class="co">#&gt; $ Type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Gross", "Gross", …</span></span>
<span><span class="co">#&gt; $ Boundary        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "All", "All", "All", "All", "All", "All"…</span></span>
<span><span class="co">#&gt; $ Non_Energy_Uses <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Excluded", "Excluded", "Excluded", "Excluded", "Exclu…</span></span>
<span><span class="co">#&gt; $ Product.Group   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All fossil fuels", "All fossil fuels", "Coal products…</span></span>
<span><span class="co">#&gt; $ Energy.stage    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final (fuel)", "Final (fuel+elec+heat)", "Final (fuel…</span></span>
<span><span class="co">#&gt; $ Group.eroi      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 8.887669, 8.887669, 5.514706, 5.514706, 31.805135, 31.…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="useful-stage-aggregations">Useful stage aggregations<a class="anchor" aria-label="anchor" href="#useful-stage-aggregations"></a>
</h3>
<p>Aggregating EROIs at the useful stage of energy use requires the
analyst to provide the average final-to-useful energy efficiencies with
which each energy product is used, in each country. Indeed, the
<code>Recca</code> package that we have used to calculate EROIs is used
on a data frame describing the Energy Conversion Chain until the final
energy stage, so that EROIs can only be calculated for products
corresponding to the primary extraction and final energy stages.</p>
<p>Alternatively, the <code>Recca</code> package could also be used to
calculate useful stage EROIs, but the matrices used should then describe
the Energy Conversion Chain until the useful energy stage, which would
require some preliminary work from the analyst anyway. To see an example
of how the Physical Supply Use Table and Input-Output matrices can be
used to describe an Energy Conversion Chain until the useful energy
stage, see <span class="citation">Heun, Owen, and Brockway
(2018)</span>.</p>
<p>Here, we will create an artificial ad-hoc data frame containing
made-up final-to-useful efficiencies to demonstrate the package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating final stage EROIs:</span></span>
<span><span class="co"># Pushing to tidy useful stage EROIs</span></span>
<span><span class="va">length_to_use</span> <span class="op">&lt;-</span> <span class="va">tidy_AB_erois_dta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Method</span>, <span class="va">Energy.type</span>, <span class="va">Year</span>, <span class="va">Product</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_FU_efficiencies_dta</span> <span class="op">&lt;-</span> <span class="va">tidy_AB_erois_dta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Method</span>, <span class="va">Energy.type</span>, <span class="va">Year</span>, <span class="va">Product</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Average_Efficiency_Col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">1</span>, <span class="fl">0.85</span><span class="op">/</span><span class="op">(</span><span class="va">length_to_use</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 18</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "B…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Blast furnace gas", "Coke oven coke", "Coking …</span></span>
<span><span class="co">#&gt; $ Average_Efficiency_Col <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50,…</span></span></code></pre></div>
<p>The analyst should provide the final-to-useful efficiencies in a
format similar to the <code>tidy_FU_efficiencies_dta</code> data frame
introduced here. Then, we can calculate the useful stage EROIs at the
product level using the <code>push_to_useful_erois</code> as:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Binding efficiencies to Input-Output EROIs</span></span>
<span><span class="va">tidy_useful_erois_dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/push_to_useful_erois.html">push_to_useful_erois</a></span><span class="op">(</span></span>
<span>    .tidy_io_erois <span class="op">=</span> <span class="va">tidy_AB_erois_dta</span>,</span>
<span>    tidy_FU_efficiencies <span class="op">=</span> <span class="va">tidy_FU_efficiencies_dta</span>,</span>
<span>    eroi_calc_method <span class="op">=</span> <span class="st">"dta"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 72</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…</span></span>
<span><span class="co">#&gt; $ Eroi.method            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA"…</span></span>
<span><span class="co">#&gt; $ Type                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Gross", "G…</span></span>
<span><span class="co">#&gt; $ Boundary               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "All", "All", "All", "All", "All"…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Blast furnace gas", "Coke oven coke", "Coking …</span></span>
<span><span class="co">#&gt; $ EROI                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5.185227, 7.239824, 91.083095, 33.935281, 26.36…</span></span>
<span><span class="co">#&gt; $ Average_Efficiency_Col <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50,…</span></span>
<span><span class="co">#&gt; $ Useful_Stage_EROI      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.7777841, 1.4479647, 22.7707738, 10.1805843, 9…</span></span>
<span>  <span class="co">#dplyr::filter(! is.na(Useful_Stage_EROI))</span></span></code></pre></div>
<p>Finally, we can aggregate useful stage EROIs in a similar way than at
the primary and final stages using the
<code>aggregate_useful_stage_erois</code> function. The function also
uses the final use shares of each product within each fossil fuel group,
as for the <code>aggregate_final_stage_erois</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating final stage EROIs:</span></span>
<span><span class="va">useful_stage_erois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_useful_stage_erois.html">aggregate_useful_stage_erois</a></span><span class="op">(</span></span>
<span>  .tidy_erois_df <span class="op">=</span> <span class="va">tidy_useful_erois_dta</span>,</span>
<span>  .tidy_iea_df <span class="op">=</span> <span class="va">tidy_AB_dta</span>,</span>
<span>  eroi_calc_method <span class="op">=</span> <span class="st">"dta"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 80</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; Groups: Country, Method, Energy.type, Last.stage, Year, Eroi.method, Type, Boundary, Non_Energy_Uses, Product.Group [40]</span></span>
<span><span class="co">#&gt; $ Country         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A",…</span></span>
<span><span class="co">#&gt; $ Method          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E",…</span></span>
<span><span class="co">#&gt; $ Last.stage      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "Final", …</span></span>
<span><span class="co">#&gt; $ Year            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, …</span></span>
<span><span class="co">#&gt; $ Eroi.method     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA"…</span></span>
<span><span class="co">#&gt; $ Type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Gross", "Gross", …</span></span>
<span><span class="co">#&gt; $ Boundary        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "All", "All", "All", "All", "All", "All"…</span></span>
<span><span class="co">#&gt; $ Non_Energy_Uses <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Excluded", "Excluded", "Excluded", "Excluded", "Exclu…</span></span>
<span><span class="co">#&gt; $ Product.Group   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All fossil fuels", "All fossil fuels", "Coal products…</span></span>
<span><span class="co">#&gt; $ Energy.stage    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Useful (fuel)", "Useful (fuel+elec+heat)", "Useful (f…</span></span>
<span><span class="co">#&gt; $ Group.eroi      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.7410808, 2.7410808, 0.8617539, 0.8617539, 17.4928241…</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="multi-regional-perspective">Multi-regional perspective<a class="anchor" aria-label="anchor" href="#multi-regional-perspective"></a>
</h2>
<div class="section level3">
<h3 id="primary-and-final-stage-aggregations-1">Primary and final stage aggregations<a class="anchor" aria-label="anchor" href="#primary-and-final-stage-aggregations-1"></a>
</h3>
<p>To perform the aggregations when using a multi-regional perspective,
the tidy data frame describing the Energy Conversion Chain needs to be
adapted first, so that the country of location of each flow is added to
the country column, and removed from the flow column. This step is
important to allow the function to calculate the share of supply
(primary stage) and use (final and useful stages) for each country. The
<code>prepare_gma_for_shares</code> function is used to this effect.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating final stage EROIs:</span></span>
<span><span class="va">tidy_AB_data_gma_prepared</span> <span class="op">&lt;-</span> <span class="va">tidy_AB_data_gma</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prepare_gma_for_shares.html">prepare_gma_for_shares</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 94</span></span>
<span><span class="co">#&gt; Columns: 13</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…</span></span>
<span><span class="co">#&gt; $ Ledger.side            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Supply", "Supply", "Supply", "Supply", "Supply…</span></span>
<span><span class="co">#&gt; $ Flow.aggregation.point <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Total primary energy supply", "Total primary e…</span></span>
<span><span class="co">#&gt; $ Flow                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Resources [of Coking coal]", "Resources [of Cr…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "{A}_Coking coal [from Resources]", "{A}_Crude …</span></span>
<span><span class="co">#&gt; $ Unit                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe",…</span></span>
<span><span class="co">#&gt; $ E.dot                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5000, 8500, 4000, 850, 5000, 400, 3200, 200, 85…</span></span>
<span><span class="co">#&gt; $ matnames               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "R", "R", "R", "V", "V", "V", "V", "V", "V", "V…</span></span>
<span><span class="co">#&gt; $ product_without_origin <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Coking coal [from Resources]", "Crude oil [fro…</span></span></code></pre></div>
<p>Note the difference with the previous data frame (Country and
Flow):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating final stage EROIs:</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">tidy_AB_data_gma</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 94</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "World", "World", "World", "World", "World", "W…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…</span></span>
<span><span class="co">#&gt; $ Ledger.side            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Supply", "Supply", "Supply", "Supply", "Supply…</span></span>
<span><span class="co">#&gt; $ Flow.aggregation.point <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Total primary energy supply", "Total primary e…</span></span>
<span><span class="co">#&gt; $ Flow                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "{A}_Resources [of Coking coal]", "{A}_Resource…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "{A}_Coking coal [from Resources]", "{A}_Crude …</span></span>
<span><span class="co">#&gt; $ Unit                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe",…</span></span>
<span><span class="co">#&gt; $ E.dot                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5000, 8500, 4000, 850, 5000, 400, 3200, 200, 85…</span></span>
<span><span class="co">#&gt; $ matnames               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "R", "R", "R", "V", "V", "V", "V", "V", "V", "V…</span></span></code></pre></div>
<p>Then the aggregation is simply conducted as:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating final stage EROIs:</span></span>
<span><span class="va">aggregated_primary_stage_erois_gma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_primary_stage_erois.html">aggregate_primary_stage_erois</a></span><span class="op">(</span></span>
<span>    .tidy_erois_df <span class="op">=</span> <span class="va">tidy_AB_erois_gma</span>,</span>
<span>    .tidy_iea_df <span class="op">=</span> <span class="va">tidy_AB_data_gma_prepared</span>,</span>
<span>    eroi_calc_method <span class="op">=</span> <span class="st">"gma"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 12</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; Groups: Country, Method, Energy.type, Last.stage, Year, Eroi.method, Type, Boundary, Product.Group [12]</span></span>
<span><span class="co">#&gt; $ Country       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "…</span></span>
<span><span class="co">#&gt; $ Method        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", …</span></span>
<span><span class="co">#&gt; $ Energy.type   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "…</span></span>
<span><span class="co">#&gt; $ Last.stage    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 20…</span></span>
<span><span class="co">#&gt; $ Eroi.method   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", …</span></span>
<span><span class="co">#&gt; $ Type          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Gross", "Gross", "N…</span></span>
<span><span class="co">#&gt; $ Boundary      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "All", "Feedstock", "Feedstock", "Feedstoc…</span></span>
<span><span class="co">#&gt; $ Product.Group <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All fossil fuels", "Coal products", "Oil and gas produc…</span></span>
<span><span class="co">#&gt; $ Energy.stage  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Primary", "Primary", "Primary", "Primary", "Primary", "…</span></span>
<span><span class="co">#&gt; $ Group.eroi    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 40.24781, 88.47164, 33.09035, 42.90249, 100.00000, 34.97…</span></span></code></pre></div>
<p>and likewise, at the final stage, as:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregating final stage EROIs:</span></span>
<span><span class="va">aggregated_final_stage_erois_gma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_final_stage_erois.html">aggregate_final_stage_erois</a></span><span class="op">(</span></span>
<span>    .tidy_erois_df <span class="op">=</span> <span class="va">tidy_AB_erois_gma</span>,</span>
<span>    .tidy_iea_df <span class="op">=</span> <span class="va">tidy_AB_data_gma_prepared</span>,</span>
<span>    eroi_calc_method <span class="op">=</span> <span class="st">"gma"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 80</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; Groups: Country, Method, Energy.type, Last.stage, Year, Eroi.method, Type, Boundary, Non_Energy_Uses, Product.Group [40]</span></span>
<span><span class="co">#&gt; $ Country         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A",…</span></span>
<span><span class="co">#&gt; $ Method          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E",…</span></span>
<span><span class="co">#&gt; $ Last.stage      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "Final", …</span></span>
<span><span class="co">#&gt; $ Year            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, …</span></span>
<span><span class="co">#&gt; $ Eroi.method     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA"…</span></span>
<span><span class="co">#&gt; $ Type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Gross", "Gross", …</span></span>
<span><span class="co">#&gt; $ Boundary        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "All", "All", "All", "All", "All", "All"…</span></span>
<span><span class="co">#&gt; $ Non_Energy_Uses <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Excluded", "Excluded", "Excluded", "Excluded", "Exclu…</span></span>
<span><span class="co">#&gt; $ Product.Group   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All fossil fuels", "All fossil fuels", "Coal products…</span></span>
<span><span class="co">#&gt; $ Energy.stage    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final (fuel)", "Final (fuel+elec+heat)", "Final (fuel…</span></span>
<span><span class="co">#&gt; $ Group.eroi      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 7.228293, 7.228293, 2.982800, 2.982800, 31.692055, 31.…</span></span></code></pre></div>
<p>Note that each product is specified by its location of production in
the Multi-Regional version of the framework. The implication is that at
the final and useful stage, when aggregating EROIs, the use shares of
each product are determined for products which are specific by region of
production. So the aggregations we conduct at the final and useful stage
are based on the consumption mix of a country, not on its production mix
(conversely to the primary stage, for which aggregations only make sense
based on the production mix).</p>
</div>
<div class="section level3">
<h3 id="useful-stage-aggregations-1">Useful stage aggregations<a class="anchor" aria-label="anchor" href="#useful-stage-aggregations-1"></a>
</h3>
<p>As for the demonstration at the domestic level, we build a made-up
data frame containing the average final-to-useful efficiencies of each
energy product to expand the EROI calculations at the useful stage for
each energy product.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Building a data frame containing average final-to-useful efficiencies for each energy product</span></span>
<span><span class="va">length_to_use</span> <span class="op">&lt;-</span> <span class="va">tidy_AB_erois_gma</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Method</span>, <span class="va">Energy.type</span>, <span class="va">Year</span>, <span class="va">Product</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_FU_efficiencies_gma</span> <span class="op">&lt;-</span> <span class="va">tidy_AB_erois_gma</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Country <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">Product</span>, <span class="st">"\\{.*\\}"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">"\\{"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">"\\}"</span><span class="op">)</span>,</span>
<span>    Product <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">Product</span>, <span class="st">"\\{.*\\}_"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Method</span>, <span class="va">Energy.type</span>, <span class="va">Year</span>, <span class="va">Product</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Average_Efficiency_Col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">1</span>, <span class="fl">0.85</span><span class="op">/</span><span class="op">(</span><span class="va">length_to_use</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 15</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "B…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Blast furnace gas", "Coke oven coke", "Coking …</span></span>
<span><span class="co">#&gt; $ Average_Efficiency_Col <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1500000, 0.2107143, 0.2714286, 0.3321429, 0.3…</span></span></code></pre></div>
<p>Then, we expand the EROI calculations to the useful stage by applying
the final-to-useful efficiencies of each energy product using the
<code>push_to_useful_erois</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pushing to tidy useful stage EROIs</span></span>
<span><span class="va">tidy_useful_erois_gma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/push_to_useful_erois.html">push_to_useful_erois</a></span><span class="op">(</span></span>
<span>  .tidy_io_erois <span class="op">=</span> <span class="va">tidy_AB_erois_gma</span>,</span>
<span>  tidy_FU_efficiencies <span class="op">=</span> <span class="va">tidy_FU_efficiencies_gma</span>,</span>
<span>  eroi_calc_method <span class="op">=</span> <span class="st">"gma"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 108</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…</span></span>
<span><span class="co">#&gt; $ Average_Efficiency_Col <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1500000, 0.1500000, 0.1500000, 0.1500000, 0.1…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Eroi.method            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA"…</span></span>
<span><span class="co">#&gt; $ Type                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Net", "Net…</span></span>
<span><span class="co">#&gt; $ Boundary               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "Feedstock", "Feedstock", "All", …</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "{A}_Blast furnace gas", "{B}_Blast furnace gas…</span></span>
<span><span class="co">#&gt; $ EROI                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.9003030, 1.4240609, 3.4010475, 1.6927454, 1.9…</span></span>
<span><span class="co">#&gt; $ Useful_Stage_EROI      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.43504546, 0.21360914, 0.51015712, 0.25391181,…</span></span></code></pre></div>
<p>Last, we can aggregate the useful stage EROIs using the
<code>aggregate_useful_stage_erois</code> function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculating aggregated useful stage EROIs:</span></span>
<span><span class="va">aggregated_useful_stage_erois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_useful_stage_erois.html">aggregate_useful_stage_erois</a></span><span class="op">(</span></span>
<span>  .tidy_erois_df <span class="op">=</span> <span class="va">tidy_useful_erois_gma</span>,</span>
<span>  .tidy_iea_df <span class="op">=</span> <span class="va">tidy_AB_data_gma_prepared</span>,</span>
<span>  eroi_calc_method <span class="op">=</span> <span class="st">"gma"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 72</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; Groups: Country, Method, Energy.type, Last.stage, Year, Eroi.method, Type, Boundary, Non_Energy_Uses, Product.Group [36]</span></span>
<span><span class="co">#&gt; $ Country         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A",…</span></span>
<span><span class="co">#&gt; $ Method          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E",…</span></span>
<span><span class="co">#&gt; $ Last.stage      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "Final", …</span></span>
<span><span class="co">#&gt; $ Year            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, …</span></span>
<span><span class="co">#&gt; $ Eroi.method     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA", "DTA"…</span></span>
<span><span class="co">#&gt; $ Type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gross", "Gross", "Gross", "Gross", "Gross", "Gross", …</span></span>
<span><span class="co">#&gt; $ Boundary        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All", "All", "All", "All", "All", "All", "All", "All"…</span></span>
<span><span class="co">#&gt; $ Non_Energy_Uses <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Excluded", "Excluded", "Excluded", "Excluded", "Exclu…</span></span>
<span><span class="co">#&gt; $ Product.Group   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "All fossil fuels", "All fossil fuels", "Coal products…</span></span>
<span><span class="co">#&gt; $ Energy.stage    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Useful (fuel)", "Useful (fuel+elec+heat)", "Useful (f…</span></span>
<span><span class="co">#&gt; $ Group.eroi      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.9917385, 1.9917385, 0.4730547, 0.4730547, 20.1470920…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Heun:2018" class="csl-entry">
Heun, Matthew Kuperus, Anne Owen, and Paul E. Brockway. 2018. <span>“A
Physical Supply-Use Table Framework for Energy Analysis on the Energy
Conversion Chain.”</span> <em>Applied Energy</em> 226 (September):
1134–62. <a href="https://doi.org/10.1016/j.apenergy.2018.05.109" class="external-link">https://doi.org/10.1016/j.apenergy.2018.05.109</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
